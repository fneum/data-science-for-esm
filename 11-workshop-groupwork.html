
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Preparation for Group Assignment &#8212; Data Science for Energy System Modelling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '11-workshop-groupwork';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sector-Coupling with pypsa" href="12-workshop-pypsa-sector-coupling.html" />
    <link rel="prev" title="Capacity Expansion Planning with pypsa" href="10-workshop-pypsa-cem.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Data Science for Energy System Modelling - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Data Science for Energy System Modelling - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-workshop-python.html">Introduction to <code class="docutils literal notranslate"><span class="pre">Python</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="02-workshop-numpy.html">Introduction to <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="03-workshop-pandas.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="04-workshop-geopandas.html">Introduction to <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> and <code class="docutils literal notranslate"><span class="pre">cartopy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="06-workshop-atlite.html">Introduction to <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> and <code class="docutils literal notranslate"><span class="pre">atlite</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="05-workshop-pysheds.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pysheds</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="07-workshop-networkx.html">Introduction to <code class="docutils literal notranslate"><span class="pre">networkx</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="14-workshop-linopy.html">Introduction to <code class="docutils literal notranslate"><span class="pre">linopy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="09-workshop-pypsa.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="10-workshop-pypsa-cem.html">Capacity Expansion Planning with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Preparation for Group Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-workshop-pypsa-sector-coupling.html">Sector-Coupling with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="13-workshop-interactive-visualisation.html">Interactive Visualisation and Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-workshop-pyomo.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pyomo</span></code></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/fneum/data-science-for-esm/blob/main/data-science-for-esm/11-workshop-groupwork.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fneum/data-science-for-esm" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fneum/data-science-for-esm/issues/new?title=Issue%20on%20page%20%2F11-workshop-groupwork.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/11-workshop-groupwork.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Preparation for Group Assignment</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparatory-downloads">Preparatory Downloads</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-historical-weather-data-from-era5-with-atlite">Downloading historical weather data from ERA5 with <code class="docutils literal notranslate"><span class="pre">atlite</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repetition-from-land-eligibility-analysis-to-availability-matrix">Repetition: From Land Eligibility Analysis to Availability Matrix</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#availability-matrix">Availability Matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solar-pv-profiles">Solar PV Profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-profiles">Wind Profiles</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-shapes-in-geopandas">Merging Shapes in <code class="docutils literal notranslate"><span class="pre">geopandas</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#representative-points-and-crow-fly-distances">Representative Points and Crow-Fly Distances</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-equal-area-and-equal-distance-crs">Global Equal-Area and Equal-Distance CRS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#country-converter">Country Converter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gurobi">Gurobi</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="preparation-for-group-assignment">
<h1>Preparation for Group Assignment<a class="headerlink" href="#preparation-for-group-assignment" title="Link to this heading">#</a></h1>
<p>This tutorial contains various small guides for tasks you will need or come in handy in the upcoming group assignment.</p>
<p>We’re going to need a couple of packages for this tutorial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">atlite.gis</span> <span class="kn">import</span> <span class="n">ExclusionContainer</span>
<span class="kn">from</span> <span class="nn">atlite.gis</span> <span class="kn">import</span> <span class="n">shape_availability</span>
<span class="kn">import</span> <span class="nn">atlite</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">country_converter</span> <span class="k">as</span> <span class="nn">coco</span>
<span class="kn">import</span> <span class="nn">atlite</span>
</pre></div>
</div>
</div>
</div>
<section id="preparatory-downloads">
<h2>Preparatory Downloads<a class="headerlink" href="#preparatory-downloads" title="Link to this heading">#</a></h2>
<p>For this tutorial, we also need to download a few files, for which one can use the <code class="docutils literal notranslate"><span class="pre">urllib</span></code> library:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;era5-2013-NL.nc&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://tubcloud.tu-berlin.de/s/bAJj9xmN5ZLZQZJ/download/&quot;</span> <span class="o">+</span> <span class="n">fn</span>
<span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;era5-2013-NL.nc&#39;, &lt;http.client.HTTPMessage at 0x7f82a78fecd0&gt;)
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326-NL.tif&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://tubcloud.tu-berlin.de/s/567ckizz2Y6RLQq/download?path=%2Fcopernicus-glc&amp;files=</span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326-NL.tif&#39;,
 &lt;http.client.HTTPMessage at 0x7f82a776d290&gt;)
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;WDPA_Oct2022_Public_shp-NLD.tif&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;https://tubcloud.tu-berlin.de/s/567ckizz2Y6RLQq/download?path=%2Fwdpa&amp;files=</span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;WDPA_Oct2022_Public_shp-NLD.tif&#39;,
 &lt;http.client.HTTPMessage at 0x7f82a776ef10&gt;)
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;GEBCO_2014_2D-NL.nc&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;https://tubcloud.tu-berlin.de/s/567ckizz2Y6RLQq/download?path=%2Fgebco&amp;files=</span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;GEBCO_2014_2D-NL.nc&#39;, &lt;http.client.HTTPMessage at 0x7f82a7774ed0&gt;)
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="downloading-historical-weather-data-from-era5-with-atlite">
<h2>Downloading historical weather data from ERA5 with <code class="docutils literal notranslate"><span class="pre">atlite</span></code><a class="headerlink" href="#downloading-historical-weather-data-from-era5-with-atlite" title="Link to this heading">#</a></h2>
<p>First, let’s load some small example country. Let’s say, the Netherlands.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;https://tubcloud.tu-berlin.de/s/567ckizz2Y6RLQq/download?path=</span><span class="si">%2F</span><span class="s2">gadm&amp;files=gadm_410-levels-ADM_1-NLD.gpkg&quot;</span>
<span class="n">regions</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/pyogrio/raw.py:198: RuntimeWarning: File /vsimem/pyogrio_b6a20fa4d17d4fa2b3e3366b3b5e6f9e has GPKG application_id, but non conformant file extension
  return ogr_read(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="_images/9c002fdd67367a9a6682c9bdae5082a350b3c7e74216063a819d44edda6c2b06.png" src="_images/9c002fdd67367a9a6682c9bdae5082a350b3c7e74216063a819d44edda6c2b06.png" />
</div>
</div>
<p>In this example we download historical weather data <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview">ERA5 data</a> on-demand for a cutout we want to create.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For this example to work, you should have</p>
<ul class="simple">
<li><p>installed the Copernicus Climate Data Store <code class="docutils literal notranslate"><span class="pre">cdsapi</span></code> package (<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span> <span class="pre">cdsapi</span></code> or <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">cdsapi</span></code>) and</p></li>
<li><p>registered and setup your CDS API key as described on <a class="reference external" href="https://cds.climate.copernicus.eu/how-to-api">this website</a>. Note that there are different instructions depending on your operating system.</p></li>
</ul>
</div>
<p>A <strong>cutout</strong> is the basis for any of your work and calculations in <code class="docutils literal notranslate"><span class="pre">atlite</span></code>.</p>
<p>The cutout is created in the directory and file specified by the relative path. If a cutout at the given location already exists, then this command will simply load the cutout again. If the cutout does not yet exist, it will specify the new cutout to be created.</p>
<p>For creating the cutout, you need to specify the dataset (e.g. ERA5), a time period and the spatial extent (in latitude and longitude).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">total_bounds</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="mf">0.25</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutout</span> <span class="o">=</span> <span class="n">atlite</span><span class="o">.</span><span class="n">Cutout</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;era5-2013-NL.nc&quot;</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;era5&quot;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">minx</span> <span class="o">-</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">miny</span> <span class="o">-</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">),</span>
    <span class="n">time</span><span class="o">=</span><span class="s2">&quot;2013&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/cutout.py:191: UserWarning: Arguments module, x, y, time are ignored, since cutout is already built.
  warn(
</pre></div>
</div>
</div>
</div>
<p>Calling the function <code class="docutils literal notranslate"><span class="pre">cutout.prepare()</span></code> initiates the download and processing of the weather data.
Because the download needs to be provided by the CDS servers, this might take a while depending on the amount of data requested.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can check the status of your request <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/yourrequests">here</a>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutout</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">Exception</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cutout</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/data.py:116,</span> in <span class="ni">maybe_remove_tmpdir.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tmpdir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">116</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">117</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span>     <span class="n">rmtree</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tmpdir&quot;</span><span class="p">])</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/data.py:208,</span> in <span class="ni">cutout_prepare</span><span class="nt">(cutout, features, tmpdir, overwrite, compression, show_progress, dask_kwargs, monthly_requests, concurrent_requests)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating and writing with module </span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span> <span class="n">missing_features</span> <span class="o">=</span> <span class="n">missing_vars</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">208</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">get_features</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>     <span class="n">cutout</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span>     <span class="n">module</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">211</span>     <span class="n">missing_features</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">212</span>     <span class="n">tmpdir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">213</span>     <span class="n">monthly_requests</span><span class="o">=</span><span class="n">monthly_requests</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span>     <span class="n">concurrent_requests</span><span class="o">=</span><span class="n">concurrent_requests</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">216</span> <span class="n">prepared</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">missing_features</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span> <span class="n">cutout</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">prepared_features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prepared</span><span class="p">)))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/data.py:59,</span> in <span class="ni">get_features</span><span class="nt">(cutout, module, features, tmpdir, monthly_requests, concurrent_requests)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>     <span class="n">feature_data</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">get_data</span><span class="p">)(</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>         <span class="n">cutout</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="n">feature</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>         <span class="o">**</span><span class="n">parameters</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>     <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_data</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">59</span> <span class="n">datasets</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="o">*</span><span class="n">datasets</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">compat</span><span class="o">=</span><span class="s2">&quot;equals&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/dask/base.py:660,</span> in <span class="ni">compute</span><span class="nt">(traverse, optimize_graph, scheduler, get, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span>     <span class="n">postcomputes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">__dask_postcompute__</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">659</span> <span class="k">with</span> <span class="n">shorten_traceback</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">660</span>     <span class="n">results</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="nn">    662 return repack([f(r, *a) for r, (f, a)</span> in <span class="ni">zip</span><span class="nt">(results, postcomputes)])</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/datasets/era5.py:468,</span> in <span class="ni">get_data</span><span class="nt">(cutout, feature, tmpdir, lock, monthly_requests, concurrent_requests, **creation_parameters)</span>
<span class="g g-Whitespace">    </span><span class="mi">465</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">466</span>     <span class="n">datasets</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">retrieve_once</span><span class="p">,</span> <span class="n">time_chunks</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">468</span> <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/xarray/core/concat.py:254,</span> in <span class="ni">concat</span><span class="nt">(objs, dim, data_vars, coords, compat, positions, fill_value, join, combine_attrs, create_index_for_new_dim)</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span> <span class="kn">from</span> <span class="nn">xarray.core.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">254</span>     <span class="n">first_obj</span><span class="p">,</span> <span class="n">objs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">peek_at</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span> <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must supply at least one object to concatenate&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/xarray/core/utils.py:200,</span> in <span class="ni">peek_at</span><span class="nt">(iterable)</span>
<span class="g g-Whitespace">    </span><span class="mi">196</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Returns the first value from iterable, as well as a new iterator with</span>
<span class="g g-Whitespace">    </span><span class="mi">197</span><span class="sd"> the same content as the original iterable</span>
<span class="g g-Whitespace">    </span><span class="mi">198</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span> <span class="n">gen</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">200</span> <span class="n">peek</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">201</span> <span class="k">return</span> <span class="n">peek</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">peek</span><span class="p">],</span> <span class="n">gen</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/datasets/era5.py:453,</span> in <span class="ni">get_data.&lt;locals&gt;.retrieve_once</span><span class="nt">(time)</span>
<span class="g g-Whitespace">    </span><span class="mi">452</span> <span class="k">def</span> <span class="nf">retrieve_once</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">453</span>     <span class="n">ds</span> <span class="o">=</span> <span class="n">func</span><span class="p">({</span><span class="o">**</span><span class="n">retrieval_params</span><span class="p">,</span> <span class="o">**</span><span class="n">time</span><span class="p">})</span>
<span class="g g-Whitespace">    </span><span class="mi">454</span>     <span class="k">if</span> <span class="n">sanitize</span> <span class="ow">and</span> <span class="n">sanitize_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span>         <span class="n">ds</span> <span class="o">=</span> <span class="n">sanitize_func</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/datasets/era5.py:218,</span> in <span class="ni">get_data_temperature</span><span class="nt">(retrieval_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span> <span class="k">def</span> <span class="nf">get_data_temperature</span><span class="p">(</span><span class="n">retrieval_params</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">216</span><span class="sd">     Get wind temperature for given retrieval parameters.</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">218</span>     <span class="n">ds</span> <span class="o">=</span> <span class="n">retrieve_data</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>         <span class="n">variable</span><span class="o">=</span><span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>             <span class="s2">&quot;2m_temperature&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>             <span class="s2">&quot;soil_temperature_level_4&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span>             <span class="s2">&quot;2m_dewpoint_temperature&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">223</span>         <span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span>         <span class="o">**</span><span class="n">retrieval_params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">225</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>     <span class="n">ds</span> <span class="o">=</span> <span class="n">_rename_and_clean_coords</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>     <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span>         <span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>             <span class="s2">&quot;t2m&quot;</span><span class="p">:</span> <span class="s2">&quot;temperature&quot;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">233</span>         <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">234</span>     <span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/atlite/datasets/era5.py:359,</span> in <span class="ni">retrieve_data</span><span class="nt">(product, chunks, tmpdir, lock, **updates)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span> <span class="n">request</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">355</span> <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span>     <span class="n">request</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span> <span class="p">),</span> <span class="s2">&quot;Need to specify at least &#39;variable&#39;, &#39;year&#39; and &#39;month&#39;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">359</span> <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span>     <span class="n">info_callback</span><span class="o">=</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">&gt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">level</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span> <span class="k">if</span> <span class="n">lock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/cdsapi/api.py:281,</span> in <span class="ni">Client.__new__</span><span class="nt">(cls, url, key, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">280</span> <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">281</span>     <span class="n">_</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_url_key_verify</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span>     <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/cdsapi/api.py:69,</span> in <span class="ni">get_url_key_verify</span><span class="nt">(url, key, verify)</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span>             <span class="n">verify</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">69</span>     <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing/incomplete configuration file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dotrc</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="c1"># If verify is still None, then we set to default value of True</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span> <span class="k">if</span> <span class="n">verify</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">Exception</span>: Missing/incomplete configuration file: /home/runner/.cdsapirc
</pre></div>
</div>
</div>
</div>
<p>The data is accessible in <code class="docutils literal notranslate"><span class="pre">cutout.data</span></code>. Included weather variables are listed in <code class="docutils literal notranslate"><span class="pre">cutout.prepared_features</span></code>. Querying the <code class="docutils literal notranslate"><span class="pre">cutout</span></code> gives us some basic information on which data is contained in it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutout</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutout</span><span class="o">.</span><span class="n">prepared_features</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutout</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="repetition-from-land-eligibility-analysis-to-availability-matrix">
<h2>Repetition: From Land Eligibility Analysis to Availability Matrix<a class="headerlink" href="#repetition-from-land-eligibility-analysis-to-availability-matrix" title="Link to this heading">#</a></h2>
<p>We’re going to use the plotting functions from previous exercises:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_area</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">show</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greens&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">shape</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we collect all exclusion and inclusion criteria in an <code class="docutils literal notranslate"><span class="pre">ExclusionContainer</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">excluder</span> <span class="o">=</span> <span class="n">ExclusionContainer</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="mi">3035</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;PROBAV_LC100_global_v3.0.1_2019-nrt_Discrete-Classification-map_EPSG-4326-NL.tif&quot;</span>
<span class="n">excluder</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
<span class="n">excluder</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;WDPA_Oct2022_Public_shp-NLD.tif&quot;</span>
<span class="n">excluder</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">3035</span><span class="p">)</span>
<span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;GEBCO_2014_2D-NL.nc&quot;</span>
<span class="n">excluder</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we can calculate the available areas…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">masked</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">shape_availability</span><span class="p">(</span><span class="n">regions</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3035</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">excluder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>… and plot it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_area</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">regions</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3035</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="availability-matrix">
<h3>Availability Matrix<a class="headerlink" href="#availability-matrix" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">GID_1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutout</span> <span class="o">=</span> <span class="n">atlite</span><span class="o">.</span><span class="n">Cutout</span><span class="p">(</span><span class="s2">&quot;era5-2013-NL.nc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">?</span>cutout.availabilitymatrix
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">cutout</span><span class="o">.</span><span class="n">availabilitymatrix</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">excluder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cap_per_sqkm</span> <span class="o">=</span> <span class="mf">1.7</span>  <span class="c1"># MW/km2</span>

<span class="n">area</span> <span class="o">=</span> <span class="n">cutout</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3035</span><span class="p">)</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="mf">1e6</span>

<span class="n">area</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;spatial&quot;</span><span class="p">))</span>

<span class="n">capacity_matrix</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">spatial</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">cap_per_sqkm</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="solar-pv-profiles">
<h3>Solar PV Profiles<a class="headerlink" href="#solar-pv-profiles" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pv</span> <span class="o">=</span> <span class="n">cutout</span><span class="o">.</span><span class="n">pv</span><span class="p">(</span>
    <span class="n">panel</span><span class="o">=</span><span class="n">atlite</span><span class="o">.</span><span class="n">solarpanels</span><span class="o">.</span><span class="n">CdTe</span><span class="p">,</span>
    <span class="n">matrix</span><span class="o">=</span><span class="n">capacity_matrix</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;latitude_optimal&quot;</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">regions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">per_unit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pv</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pv</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="wind-profiles">
<h3>Wind Profiles<a class="headerlink" href="#wind-profiles" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind</span> <span class="o">=</span> <span class="n">cutout</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span>
    <span class="n">atlite</span><span class="o">.</span><span class="n">windturbines</span><span class="o">.</span><span class="n">Vestas_V112_3MW</span><span class="p">,</span>
    <span class="n">matrix</span><span class="o">=</span><span class="n">capacity_matrix</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">regions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">per_unit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="merging-shapes-in-geopandas">
<h2>Merging Shapes in <code class="docutils literal notranslate"><span class="pre">geopandas</span></code><a class="headerlink" href="#merging-shapes-in-geopandas" title="Link to this heading">#</a></h2>
<p>Spatial data is often more granular than we need. For example, we might have data on sub-national units, but we’re actually interested in studying patterns at the level of countries.</p>
<p>Whereas in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> we would use the <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> function to aggregate entries, in <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>, we aggregate geometric features using the <code class="docutils literal notranslate"><span class="pre">dissolve()</span></code> function.</p>
<p>Suppose we are interested in studying continents, but we only have country-level data like the country dataset included in <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>. We can easily convert this to a continent-level dataset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See also <a class="reference external" href="https://geopandas.org/en/stable/docs/user_guide/aggregation_with_dissolve.html">https://geopandas.org/en/stable/docs/user_guide/aggregation_with_dissolve.html</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">&quot;naturalearth_lowres&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">continents</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;continent&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span>

<span class="n">continents</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>If we are interested in the population per continent, we can pass different aggregation strategies to the <code class="docutils literal notranslate"><span class="pre">dissolve()</span></code> functionusing the <code class="docutils literal notranslate"><span class="pre">aggfunc</span></code> argument:</p>
<p><a class="reference external" href="https://geopandas.org/en/stable/docs/user_guide/aggregation_with_dissolve.html#dissolve-arguments">https://geopandas.org/en/stable/docs/user_guide/aggregation_with_dissolve.html#dissolve-arguments</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">continents</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;continent&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pop_est</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">continents</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;pop_est&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>You can also pass a <code class="docutils literal notranslate"><span class="pre">pandas.Series</span></code> to the <code class="docutils literal notranslate"><span class="pre">dissolve()</span></code> function that describes your mapping for more exotic aggregation strategies (e.g. by first letter of the country name):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">world</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aggfunc</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pop_est</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;pop_est&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="representative-points-and-crow-fly-distances">
<h2>Representative Points and Crow-Fly Distances<a class="headerlink" href="#representative-points-and-crow-fly-distances" title="Link to this heading">#</a></h2>
<p>The following example includes code to retrieve representative points from polygons and to calculate the distance on a sphere between two points.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See also <a class="reference external" href="https://en.wikipedia.org/wiki/Haversine_formula">https://en.wikipedia.org/wiki/Haversine_formula</a></p>
<p>See also <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoSeries.distance.html">https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoSeries.distance.html</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">&quot;naturalearth_lowres&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">representative_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">points</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4087</span><span class="p">)</span>
<span class="n">points</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">iso_a3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">points</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span>
    <span class="mf">1e3</span>
<span class="p">)</span>  <span class="c1"># km</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distances</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;DEU&quot;</span><span class="p">,</span> <span class="s2">&quot;NLD&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutout</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;2013-01-01 00:00&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="global-equal-area-and-equal-distance-crs">
<h2>Global Equal-Area and Equal-Distance CRS<a class="headerlink" href="#global-equal-area-and-equal-distance-crs" title="Link to this heading">#</a></h2>
<p>Previously, we used EPSG:3035 as projection to calculate the area of regions in km². However, this projection is not correct for regions outside of Europe, so that we need to pick different, more suitable projections for calculating areas and distances between regions.</p>
<ul class="simple">
<li><p><strong>for calculating distances:</strong> <a class="reference external" href="https://epsg.io/4087">WGS 84 / World Equidistant Cylindrical (EPSG:4087)</a></p></li>
<li><p><strong>for calculating areas:</strong> <a class="reference external" href="https://epsg.io/54009">Mollweide (ESRI:54009)</a></p></li>
</ul>
<p>The unit of measurement for both projections is metres.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AREA_CRS</span> <span class="o">=</span> <span class="s2">&quot;ESRI:54009&quot;</span>
<span class="n">DISTANCE_CRS</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4087&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">&quot;naturalearth_lowres&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">AREA_CRS</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">DISTANCE_CRS</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="country-converter">
<h2>Country Converter<a class="headerlink" href="#country-converter" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>The country converter (coco) is a Python package to convert and match country names between different classifications and between different naming versions.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See also <a class="github reference external" href="https://github.com/konstantinstadler/country_converter">konstantinstadler/country_converter</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">country_converter</span> <span class="k">as</span> <span class="nn">coco</span>
</pre></div>
</div>
</div>
</div>
<p>Convert various country names to some standard names, specifying source and target classification scheme:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coco</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="s2">&quot;NLD&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&quot;name_official&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coco</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="s2">&quot;NLD&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&quot;iso2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coco</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="s2">&quot;NLD&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;iso3&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&quot;iso2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AE&quot;</span><span class="p">,</span> <span class="s2">&quot;AL&quot;</span><span class="p">,</span> <span class="s2">&quot;AM&quot;</span><span class="p">,</span> <span class="s2">&quot;AO&quot;</span><span class="p">,</span> <span class="s2">&quot;AR&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coco</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">country_list</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;iso2&quot;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&quot;short_name&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>List of included country classification schemes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc</span> <span class="o">=</span> <span class="n">coco</span><span class="o">.</span><span class="n">CountryConverter</span><span class="p">()</span>
<span class="n">cc</span><span class="o">.</span><span class="n">valid_country_classifications</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="gurobi">
<h2>Gurobi<a class="headerlink" href="#gurobi" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://www.gurobi.com/">Gurobi</a> is one of the most powerful solvers to solve optimisation problems.
It is a commercial solver, with free academic licenses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using this solver for the group assignment is optional. You can also use other open-source alternatives, but they might just take a little longer to solve.</p>
</div>
<p>To set up Gurobi, you need to:</p>
<ul class="simple">
<li><p>Register at <a class="reference external" href="https://pages.gurobi.com/registration/">https://pages.gurobi.com/registration/</a> with your institutional e-mail address (e.g. <code class="docutils literal notranslate"><span class="pre">&#64;campus.tu-berlin.de</span></code>).</p></li>
<li><p>Follow the getting started guide for your respective operating system at <a class="reference external" href="https://www.gurobi.com/documentation/quickstart.html">https://www.gurobi.com/documentation/quickstart.html</a> (this includes a guide for retrieving your academic license and installing the software).</p></li>
<li><p>In your <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment, install <code class="docutils literal notranslate"><span class="pre">gurobipy</span></code> with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">gurobipy</span></code>.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ""
        },
        kernelOptions: {
            name: "",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = ''</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="10-workshop-pypsa-cem.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Capacity Expansion Planning with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="12-workshop-pypsa-sector-coupling.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Sector-Coupling with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparatory-downloads">Preparatory Downloads</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-historical-weather-data-from-era5-with-atlite">Downloading historical weather data from ERA5 with <code class="docutils literal notranslate"><span class="pre">atlite</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repetition-from-land-eligibility-analysis-to-availability-matrix">Repetition: From Land Eligibility Analysis to Availability Matrix</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#availability-matrix">Availability Matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solar-pv-profiles">Solar PV Profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-profiles">Wind Profiles</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-shapes-in-geopandas">Merging Shapes in <code class="docutils literal notranslate"><span class="pre">geopandas</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#representative-points-and-crow-fly-distances">Representative Points and Crow-Fly Distances</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-equal-area-and-equal-distance-crs">Global Equal-Area and Equal-Distance CRS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#country-converter">Country Converter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gurobi">Gurobi</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabian Neumann
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>